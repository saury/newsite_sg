<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <title>Admin</title>
    <link rel="stylesheet" href="css/admin.css">
    <!--[if lt IE 9]> 
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.js"></script>
    <script src="js/bootstrap/H5F.js"></script>
    <script src="js/selectivizr.js"></script>
    <![endif]-->
    <!-- 
        Notes:
        h5f: html5 form validator
        selectivizr: css3 psuedo selector
     -->
</head>

<body>
    <!-- header start -->
    <header>
        <!-- 2nd header bar start-->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <!-- icon button for mobile platform -->
                    <a class="navbar-brand" href="#top">
                        <img alt="logo" src="img/logo.png">
                    </a>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
                    <!-- navs float right -->
                    <ul class="nav navbar-nav navbar-left navbar-search">
                        <li><a href="#">订单中心</a></li>
                        <li><a href="#">站点管理</a></li>
                        <li><a href="#">物流管理</a></li>
                        <li><a href="#">会员管理</a></li>
                        <li><a class="active" href="#">财务管理</a></li>
                        <li><a href="#">数据分析</a></li>
                        <li><a href="#">系统管理</a></li>
                        <!-- <li class="dropdown navbar-search-dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span>Product</span> <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">Product</a></li>
                                <li><a href="#">Link</a></li>
                            </ul>
                        </li> -->
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container-fluid -->
        </nav>
        <!-- 2nd header bar end-->
    </header>
    <!-- header end -->
    <!-- aside nav start -->
    <aside class="nav-aside">
        <nav>
            <ul class="nav nav-pills nav-stacked">
                <li>
                    <div class="nav-aside-avatar">
                        <img class="img-responsive" src="img/brands-thumb.jpg" alt="avatar">
                    </div>
                    <b>admin</b>
                </li>
                <hr>
                <li class="navbar-text">充值管理</li>
                <li><a href="./admin_audit.html">转账审核</a></li>
                <li><a href="#">退款申请（暂无）</a></li>
                <li><a href="./admin_record.html">充值记录</a></li>
                <hr>
                <li class="navbar-text">价格管理</li>
                <li class="active"><a href="./admin_adjust_interval.html">区间调价</a></li>
                <li><a href="./admin_adjust_category.html">分类调价</a></li>
                <li><a href="./admin_adjust_prod.html">商品调价</a></li>
                <hr>
            </ul>
        </nav>
    </aside>
    <!-- aside nav end -->
    <!-- main body start -->
    <div class="adminMain">
        <!-- breadcrumb and search form start -->
        <div class="adminMain-header cf">
            <ol class="breadcrumb fll">
                <li><a href="#">充值管理</a></li>
                <li class="active">转账审核</li>
            </ol>
            <form class="flr">
                <select class="selectpicker">
                    <option value="">商品搜索1</option>
                    <option value="">商品搜索2</option>
                </select>
                <select class="selectpicker">
                    <option value="">按商品ID</option>
                    <option value="">按商品名称</option>
                </select>
                <div class="adminMain-header-input">
                    <label for="search1"><i class="glyphicon glyphicon-search"></i></label>
                    <input type="text" id="search1">
                    <a href="#" class="btn btn-primary">搜索</a>
                </div>
            </form>
        </div>
        <!-- breadcrumb and search form end -->
        <!-- price adjust start -->
        <div class="row">
            <!-- interval adjust start -->
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-2">
                        <h5>区间调价</h5>
                    </div>
                    <div class="col-md-2">
                        <a href="#" class="btn btn-primary btn-sm btn-block btn-create">新增</a>
                    </div>
                    <div class="col-md-2">
                        <a href="#" class="btn btn-primary btn-sm btn-block btn-save">保存</a>
                    </div>
                </div>
                <div class="table-admin">
                    <div class="table-thead small cf">
                        <div class="col-md-5">
                            价格区间
                        </div>
                        <div class="col-md-5 col-md-offset-2">
                            调价比例
                        </div>
                    </div>
                    <div class="table-row cf has-border">
                        <div class="col-md-5 pure-g-wrap">
                            <div class="pure-u-5-12">
                                <input type="text" role="scope" class="text-center" value="">
                            </div>
                            <div class="pure-u-1-6">~</div>
                            <div class="pure-u-5-12">
                                <input type="text" role="scope" class="text-center" value="">
                            </div>
                        </div>
                        <div class="col-md-2"><small class="ft-danger"></small></div>
                        <div class="col-md-5 pure-g-wrap">
                            <div class="pure-u-5-12">
                                <input type="text" role="scale" class="text-center" value="">
                            </div>
                            <div class="pure-u-1-6">%</div>
                            <div class="pure-u-5-12 text-right">
                                <a href="#" class="btn btn-danger btn-sm">删除</a>
                            </div>
                        </div>
                    </div>
                    <div class="table-row cf has-border">
                        <div class="col-md-5 pure-g-wrap">
                            <div class="pure-u-5-12">
                                <input type="text" role="scope" class="text-center" value="10">
                            </div>
                            <div class="pure-u-1-6">~</div>
                            <div class="pure-u-5-12">
                                <input type="text" role="scope" class="text-center" value="49">
                            </div>
                        </div>
                        <div class="col-md-2"><small class="ft-danger"></small></div>
                        <div class="col-md-5 pure-g-wrap">
                            <div class="pure-u-5-12">
                                <input type="text" role="scale" class="text-center" value="50">
                            </div>
                            <div class="pure-u-1-6">%</div>
                            <div class="pure-u-5-12 text-right">
                                <a href="#" class="btn btn-danger btn-sm">删除</a>
                            </div>
                        </div>
                    </div>
                    <div class="table-row cf has-border">
                        <div class="col-md-5 pure-g-wrap">
                            <div class="pure-u-5-12">
                                <input type="text" role="scope" class="text-center" value="50">
                            </div>
                            <div class="pure-u-1-6">~</div>
                            <div class="pure-u-5-12">
                                <input type="text" role="scope" class="text-center" value="99">
                            </div>
                        </div>
                        <div class="col-md-2"><small class="ft-danger"></small></div>
                        <div class="col-md-5 pure-g-wrap">
                            <div class="pure-u-5-12">
                                <input type="text" role="scale" class="text-center" value="50">
                            </div>
                            <div class="pure-u-1-6">%</div>
                            <div class="pure-u-5-12 text-right">
                                <a href="#" class="btn btn-danger btn-sm">删除</a>
                            </div>
                        </div>
                    </div>
                    <div class="table-row cf has-border">
                        <div class="col-md-5 pure-g-wrap">
                            <div class="pure-u-5-12">
                                <input type="text" role="scope" class="text-center" value="100">
                            </div>
                            <div class="pure-u-1-6">~</div>
                            <div class="pure-u-5-12">
                                <input type="text" role="scope" class="text-center" value="199">
                            </div>
                        </div>
                        <div class="col-md-2"><small class="ft-danger"></small></div>
                        <div class="col-md-5 pure-g-wrap">
                            <div class="pure-u-5-12">
                                <input type="text" role="scale" class="text-center" value="50">
                            </div>
                            <div class="pure-u-1-6">%</div>
                            <div class="pure-u-5-12 text-right">
                                <a href="#" class="btn btn-danger btn-sm">删除</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- interval adjust end -->
        </div>
        <!-- price adjust end -->
    </div>
    <!-- main body end -->
    <!-- footer start -->
    <footer></footer>
    <!-- footer end -->
    <!-- Login Modal srart-->
    <!-- Login Modal end-->
    <script src="js/jquery-1.11.3.js"></script>
    <script src="js/bootstrap/transition.js"></script>
    <script src="js/bootstrap/dropdown.js"></script>
    <script src="js/bootstrap/modal.js"></script>
    <script src="js/bootstrap/tooltip.js"></script>
    <script src="js/bootstrap/popover.js"></script>
    <script src="js/bootstrap/tab.js"></script>
    <script src="js/bootstrap/validator.js"></script>
    <script src="js/bootstrap/button.js"></script>
    <script src="js/bootstrap/affix.js"></script>
    <script src="js/bootstrap/scrollspy.js"></script>
    <script src="js/bootstrap/bootstrap-select.js"></script>
    <script src="js/bootstrap/ekko-lightbox.js"></script>
    <script src="js/bootstrap/collapse.js"></script>
    <!-- general script -->
    <script>
    $(function() {
        //zmall modual init
        var zmModual = (function() {
            var navOffset = 80;
            //checkbox toggle
            $(".zm-checkbox").click(function() {
                $(this).children("i").toggle();
            });
            //scrollspy for brands page
            $('.zmBrandsPage').scrollspy({
                target: '#brandNav',
                offset: navOffset + 1
            });
            //general affix overflow
            function callAffixOverflow() {
                $('[data-affix="overflow"]').each(function() {
                    var ele = $(this);
                    var offsetTop = ele.offset().top - $(window).height() - parseInt(ele.css("margin-top").split("px")[0]);
                    //affix top = offset to top - element's margin-top - window's height
                    ele.affix("destroy"); //destroy the affix function berfore
                    if (offsetTop < 0) return false; //no affix while it is not overflow
                    ele.affix({
                        offset: {
                            top: function() {
                                return offsetTop; // distance to the top
                            }
                        }
                    });
                });
            };
            //active the login or register tab
            function logOrReg(opt) {
                // body...
                switch (opt) {
                    case "log":
                        $("#myLogin .nav-tabs li").eq(0).children("a").trigger("click");
                        break;
                    default:
                        $("#myLogin .nav-tabs li").eq(1).children("a").trigger("click");
                }
            };

            // function for setting the html template of the cart details
            function setCartContent(item, overflow) {
                //hide the "Still have xx more products" when the num is 0
                if (overflow) var _overflowStr = '<div><p><strong>Still have ' + overflow + ' more products</strong></p></div>';
                else _overflowStr = '';
                //return the whole cart list string
                return '<ul>' +
                    '<li>' + item + '</li>' +
                    '</ul>' +
                    _overflowStr +
                    '<button href="#">Checking my cart</button>';
            };

            //function for the floor jumping
            function scrollToPosition(dom) {
                $("html, body").animate({
                    scrollTop: dom.offset().top - navOffset + "px"
                }, {
                    duration: 300,
                    easing: "swing"
                });
                return false;
            };

            //return all the functions
            return {
                navOffset: navOffset,
                setCartCnt: setCartContent,
                scroll: scrollToPosition,
                login: logOrReg,
                callAOF: callAffixOverflow
            };
        })();
        // bootstrap dropdown
        $('.dropdown-toggle').dropdown();
        //reset all the form value
        $("input[type=reset]").trigger("click");
        // init the href
        $("*").click(function() {
            var linkHref = $(this).attr("data-href");
            if (linkHref) window.location.href = linkHref; //window.open(linkHref);
        });
        //expand the input area
        $(".adminMain-header-input input").focus(function() {
            $(this).parent().addClass("expand");
        }).blur(function() {
            $(this).parent().removeClass("expand");
        });
        // delegate calls to data-toggle="lightbox"
        $(document).delegate('*[data-toggle="lightbox"]', 'click', function(event) {
            event.preventDefault();
            $(this).ekkoLightbox();
        });


        // button to creat a new row
        $('.btn-create').click(function() {
            //clone the table row and empty it
            var new_row = $('.table-row').eq(0).clone();
            new_row.find("input").val("");
            //insert after the table head
            $(".table-thead").after(new_row);
        });

        // button to save
        $('.btn-save').click(function() {
            // keep the value 0 unless there's an error 
            var error_count = 0;

            // recover all the error message
            $('.table-row').each(function() {
                //background color
                $(this).removeClass('bg-danger');
                //error message
                $(this).find('.ft-danger').empty();
                //the row's order
                var order = $('.table-row').index($(this));

                // check if the scales are correct
                var adjust_scale = $(this).find('input[role="scale"]').val();

                if (isNaN(adjust_scale) || adjust_scale == "" || adjust_scale < 0) {
                    showError(order, "比例无效");
                    error_count++;
                    return false;
                }
            });

            // get the scope group
            var result = getScopeGroup($('input[role="scope"]'));

            // loop for the group
            for (var i = 0; i < result.length; i++) {
                var num_start = parseInt(result[i][0]),
                    num_end = parseInt(result[i][1]);
                //check if the num is null
                if (isNaN(num_start) || isNaN(num_end) || num_start == "" || num_end == "") {
                    showError(i, "数值无效");
                    return false;
                }
                //start number should be larger than the end number
                if (num_start > num_end) {
                    showError(i, "区间有误");
                    return false;
                }
                //intersection check
                for (var j = i + 1; j < result.length; j++) {
                    // console.log(num_start, num_end, result[j][0], result[j][1])
                    if (intersection(num_start, num_end, parseInt(result[j][0]), parseInt(result[j][1]))) {
                        showError(i, "区间冲突");
                        showError(j, "区间冲突");
                        error_count++;
                    }
                }
            };

            // stop when any error exists
            if (error_count != 0) return false;
            console.log("Well done! You can use ajax to transfer the data now!");
        });

        function showError(row, keywords) {
            // show the messages among the assigned rows
            var target = $('.table-row').eq(row);
            var error = target.find(".ft-danger");
            target.addClass('bg-danger');
            error.html(keywords);
        }

        function getScopeGroup(scope) {
            //get the array and group them into the format of [[a,b],[c,d]...]
            var scopeArr = [],
                result = [];
            //loop to get all the array
            for (var i in scope) {
                if (scope.eq(i).val() !== undefined) //avoid undefined case
                    scopeArr.push(scope.eq(i).val());
            }
            //loop to group them as the format
            for (var j = 0, len = scopeArr.length; j < len; j += 2) {
                result.push(scopeArr.slice(j, j + 2));
            }
            //return the array
            return result;
        }

        function intersection(a, b, c, d) {
            // check if intersection between [a,b] and [c,d]
            if ((parseInt(a) >= parseInt(c) && parseInt(a) <= parseInt(d)) || (parseInt(b) >= parseInt(c) && parseInt(b) <= parseInt(d)) || (parseInt(c) >= parseInt(a) && parseInt(c) <= parseInt(b)) || (parseInt(d) >= parseInt(a) && parseInt(d) <= parseInt(b))) return !0; //boolean to return
            else return !1;
        }
    });
    </script>
    <!--[if lt IE 9]> 
    <script>
        //html5 form validator for browser lower than ie9
        H5F.setup($('form[data-toggle="validator"]'));
    </script>
    <![endif]-->
</body>

</html>
